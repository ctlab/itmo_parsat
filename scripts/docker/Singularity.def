Bootstrap: docker
From: ubuntu:20.04
Stage: spython-base

%post

export DEBIAN_FRONTEND=nointeractive

mkdir /home/libraries
cd /home/libraries

# Apt packages
apt update && apt upgrade -y && \
apt install -y wget gcc-10 g++-10 gcc g++ make libssl-dev libgtest-dev libunwind-dev lzma-dev \
libgoogle-glog-dev git libpqxx-dev zlib1g-dev vim doxygen clang-format libtbb-dev

# CMake
wget https://github.com/Kitware/CMake/releases/download/v3.23.0-rc1/cmake-3.23.0-rc1.tar.gz && \
tar xvf cmake-3.23.0-rc1.tar.gz --no-same-owner && cd cmake-3.23.0-rc1 && \
./configure && make -j $(nproc) && make install

# Boost 1.76
wget https://boostorg.jfrog.io/artifactory/main/release/1.76.0/source/boost_1_76_0.tar.gz && \
tar xf boost_1_76_0.tar.gz --no-same-owner && cd boost_1_76_0 && \
./bootstrap.sh && ./b2 install

# GLog
git clone https://github.com/google/glog.git && \
cd glog && \
cmake -S . -B build -G "Unix Makefiles" && \
cmake --build build && \
cmake --build build --target install

# Protobuf
wget https://github.com/protocolbuffers/protobuf/releases/download/v3.14.0/protobuf-all-3.14.0.tar.gz && \
tar xvf protobuf-all-3.14.0.tar.gz --no-same-owner && cd protobuf-3.14.0 && \
./configure && make -j $(nproc) && make install && ldconfig

# Google benchmark
git clone https://github.com/google/benchmark.git && \
cd benchmark && \
cmake -E make_directory "build" && \
cmake -E chdir "build" cmake -DBENCHMARK_DOWNLOAD_DEPENDENCIES=on -DCMAKE_BUILD_TYPE=Release ../ && \
cmake --build "build" --config Release && \
cmake --build "build" --config Release --target install

cd /home
%runscript
cd /home
exec /bin/bash "$@"
%startscript
cd /home
exec /bin/bash "$@"