cmake_minimum_required(VERSION 3.16)
project(itmo-parsat)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

option(DISABLE_TRACE "Disable timing tracer."    OFF)
option(DISABLE_LOG "Disable all logging."        OFF)
option(DISABLE_CHECKS "Disable internal checks." OFF)
option(DISABLE_ASSERT "Disable all checks."      OFF)

if (CMAKE_BUILD_TYPE STREQUAL "DEBUG")
    message(STATUS "DEBUG build mode.")
    add_compile_options(-O0 -g)
elseif (CMAKE_BUILD_TYPE STREQUAL "DEV_FAST")
    message(STATUS "DEV_FAST build mode.")
    add_compile_options(-Ofast -march=native)
elseif(CMAKE_BUILD_TYPE STREQUAL "RELEASE")
    message(STATUS "RELEASE build mode.")
    set(DISABLE_TRACE ON CACHE BOOL "" FORCE)
    set(DISABLE_LOG ON CACHE BOOL "" FORCE)
    set(DISABLE_CHECKS ON CACHE BOOL "" FORCE)
    set(DISABLE_ASSERT ON CACHE BOOL "" FORCE)
    add_compile_options(-Ofast -march=native)
endif()

if (DISABLE_TRACE)
    add_compile_definitions(DISABLE_TRACE)
endif()

if (DISABLE_LOG)
    add_compile_definitions(DISABLE_LOG)
endif()

if (DISABLE_CHECKS)
    add_compile_definitions(DISABLE_CHECK_ASGN)
endif()

if (DISABLE_ASSERT)
    add_compile_definitions(DISABLE_CHECK_ASGN)
    add_compile_definitions(DISABLE_VERIFY)
endif()

find_package(GTest REQUIRED)
find_package(glog REQUIRED)
find_package(Boost 1.76 COMPONENTS program_options timer REQUIRED)
find_package(Protobuf REQUIRED)
find_package(MPI REQUIRED)

include_directories(.)
include_directories(SYSTEM ${MPI_INCLUDE_PATH})
include_directories(${CMAKE_BINARY_DIR})
include_directories(${glog_INCLUDE_DIRS})
include_directories(${Boost_INCLUDE_DIR})
include_directories(${Protobuf_INCLUDE_DIRS})
include_directories(${GTEST_INCLUDE_DIR})
include_directories(${MPI_INCLUDE_DIRS})
include_directories(core/sat/minisat)

add_subdirectory(core)
add_subdirectory(infra)
add_subdirectory(cli)
