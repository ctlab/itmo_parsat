cmake_minimum_required(VERSION 3.16)
project(itmo-parsat)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

option(SANITIZE "Enable -fsanitize=address" OFF)

if (CMAKE_BUILD_TYPE STREQUAL "DEBUG")
    message(STATUS "DEBUG build mode. All checks are enabled, log and tracer are enabled.")
    add_compile_options(-O0 -g)
elseif (CMAKE_BUILD_TYPE STREQUAL "DEV_FAST")
    message(STATUS "DEV_FAST build mode: internal checks disabled.")
    add_compile_definitions(DISABLE_CHECK_ASGN)
    add_compile_definitions(NDEBUG)
    add_compile_options(-O3 -march=native -finline-functions)
elseif (CMAKE_BUILD_TYPE STREQUAL "RELEASE")
    message(STATUS "RELEASE build mode. All checks, log and tracer disabled.")
    add_compile_definitions(DISABLE_TRACE)
    add_compile_definitions(DISABLE_CHECK_ASGN)
    add_compile_definitions(DISABLE_VERIFY)
    add_compile_definitions(DISABLE_LOG)
    add_compile_definitions(NDEBUG)
    add_compile_options(-O3 -march=native -finline-functions)
endif ()

if (SANITIZE)
    message(STATUS "Memory sanitizer enabled.")
    add_compile_options(-O3 -march=native -finline-functions)
    add_link_options(-fsanitize=address)
endif ()

find_package(GTest REQUIRED)
find_package(glog REQUIRED)
find_package(Boost 1.76 COMPONENTS program_options timer REQUIRED)
find_package(Protobuf REQUIRED)

include_directories(.)

add_subdirectory(util)
add_subdirectory(core)
add_subdirectory(infra)
add_subdirectory(cli)
